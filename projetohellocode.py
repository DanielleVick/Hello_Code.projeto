# ------------------- IMPORTS -------------------
import re  # Para express√µes regulares

# ------------------- VARI√ÅVEIS GLOBAIS -------------------
jogadores = {}
rodando = True
historico = []
xp = 0
nivel = 1
meta_xp = 100

# ------------------- FUN√á√ïES -------------------

def iniciar_jogo():
    print("Bem-vindo(a) ao Hello Code!")

def menu_inicial():
    print("\n===== MENU INICIAL =====")
    print("1. Cadastro")
    print("2. Login")

def login():
    print("Login selecionado.")

# ---------- CADASTRO ----------
def validar_data_nascimento(data):
    return bool(re.match(r"^\d{2}/\d{2}/\d{4}$", data))

def validar_senha(senha):
    if 6 <= len(senha) <= 10 and re.search(r"[A-Z]", senha) and re.search(r"[^A-Za-z0-9]", senha):
        return True
    return False

def cadastro():
    while True:
        nome = input("\nNome do jogador: ").strip()
        if nome in jogadores:
            print("‚ùå J√° existe um jogador com esse nome. Tente outro.")
            continue

        while True:
            data_nascimento = input("Data de nascimento (DD/MM/AAAA): ").strip()
            if validar_data_nascimento(data_nascimento):
                break
            print("‚ùå Data inv√°lida! Use o formato DD/MM/AAAA.")

        while True:
            senha = input("Senha: ").strip()
            if validar_senha(senha):
                break
            print("‚ùå Senha inv√°lida! Deve ter de 6 a 10 caracteres, com 1 mai√∫scula e 1 especial.")

        jogadores[nome] = {"data_nascimento": data_nascimento, "senha": senha}
        print("‚úÖ Jogador cadastrado com sucesso!")
        break

# ---------- ATUALIZA√á√ÉO ----------
def atualizar_jogador():
    nome = input("\nNome do jogador para atualizar: ").strip()
    if nome not in jogadores:
        print("‚ùå Jogador n√£o encontrado.")
        return

    while True:
        print("\nO que deseja atualizar?")
        print("1. Data de nascimento")
        print("2. Senha")
        print("3. Voltar")
        opcao = input("Escolha: ").strip()

        if opcao == "1":
            while True:
                nova_data = input("Nova data (DD/MM/AAAA): ").strip()
                if validar_data_nascimento(nova_data):
                    jogadores[nome]["data_nascimento"] = nova_data
                    print("‚úÖ Data atualizada com sucesso!")
                    break
                print("‚ùå Data inv√°lida! Tente novamente.")
        elif opcao == "2":
            while True:
                nova_senha = input("Nova senha: ").strip()
                if validar_senha(nova_senha):
                    jogadores[nome]["senha"] = nova_senha
                    print("‚úÖ Senha atualizada com sucesso!")
                    break
                print("‚ùå Senha inv√°lida! Tente novamente.")
        elif opcao == "3":
            break
        else:
            print("‚ùå Op√ß√£o inv√°lida.")

# ---------- MENU PRINCIPAL ----------
def menu_principal():
    while True:
        print("\n===== MENU PRINCIPAL =====")
        print("1. Selecionar o n√≠vel de conhecimento")
        print("2. Seguir para tutorial adaptado")
        print("3. Ir para Fase 1")
        opcao = input("Escolha: ").strip()

        if opcao == "1":
            print("Fun√ß√£o nivel_conhecimento() n√£o implementada.")  # placeholder
        elif opcao == "2":
            print("Fun√ß√£o tutorial_adaptado() n√£o implementada.")  # placeholder
        elif opcao == "3":
            break
        else:
            print("‚ùå Op√ß√£o inv√°lida.")

# ---------- MENU DE JOGADORES ----------
def menu():
    while True:
        print("\n===== MENU DE JOGADORES =====")
        print("1. Cadastrar jogador")
        print("2. Atualizar jogador")
        print("3. Ir para o menu principal")
        print("4. Sair")
        opcao = input("Escolha uma op√ß√£o: ").strip()

        if opcao == "1":
            cadastro()
        elif opcao == "2":
            atualizar_jogador()
        elif opcao == "3":
            menu_principal()
            break  # sai do menu de jogadores e vai pros n√≠veis
        elif opcao == "4":
            print("üëã Saindo do sistema...")
            exit()
        else:
            print("‚ùå Op√ß√£o inv√°lida.")

# ---------- FUN√á√ïES DAS FASES ----------
def passar_nivel():
    global nivel, xp, meta_xp
    if xp >= meta_xp:
        nivel += 1
        xp -= meta_xp
        meta_xp += 100
        print(f"Parab√©ns! Voc√™ subiu para o n√≠vel {nivel}!")
        print(f"Pr√≥ximo n√≠vel em {meta_xp} XP.")

def nivel_1():
    print("Bem-vindo(a) ao N√≠vel 1: Cozinha do Caos!")
    print("Em uma receita, temos: 3 ovos, 2 x√≠caras de farinha, 1 x√≠cara de a√ß√∫car e 1/2 x√≠cara de leite.")
    print("Qual a ordem correta de passos para fazer um bolo?")
    print("""
    1- Pegar um recipiente
    2- Colocar a forma no forno
    3- Untar a forma
    4- Adicionar os ovos
    5- Ligar o forno
    6- Adicionar os ingredientes l√≠quidos
    7- Colocar a massa na forma
    8- Retirar do forno
    9- Adicionar os ingredientes secos
    """)
    resposta = input("Digite a ordem correta dos passos, separados por v√≠rgula: ").strip()
    global xp
    if resposta == "1,9,4,6,3,7,5,2,8":
        print("Parab√©ns! Voc√™ acertou!")
        xp += 20
        passar_nivel()
        historico.append("Desafio 1: Passou")
        return True
    else:
        print("Tente novamente!")
        historico.append("Desafio 1: N√£o passou")
        return False

def nivel_2():
    print("Bem-vindo(a) ao N√≠vel 2: Mercado Desorganizado!")
    prateleiras = {
        "frutas": ["ma√ßa", "banana", "biscoito", "laranja"],
        "verduras": ["alface", "tomate", "cenoura", "refrigerante"],
        "carnes": ["frango", "carne bovina", "peixe", "detergente"],
        "doces": ["chocolate", "bala", "sorvete", "arroz"],
        "produtos de limpeza": ["sab√£o", "desinfetante", "amaciante", "feij√£o"]
    }
    for categoria in prateleiras:
        print(f"{categoria.capitalize()}: {', '.join(prateleiras[categoria])}")

    resposta = input("Digite 1 item que est√° no lugar errado: ").strip().lower()
    itens_errados = "biscoito", "refrigerante", "detergente", "arroz", "feij√£o"
    global xp
    if resposta in itens_errados:
        print("Parab√©ns! Voc√™ acertou!")
        xp += 20
        passar_nivel()
        historico.append(f"Desafio 2: Acertou o item {resposta}")
        return True
    else:
        print("Tente novamente!")
        historico.append("Desafio 2: N√£o acertou")
        return False

def nivel_3():
    print("Bem-vindo(a) ao N√≠vel 3: Cidade dos Erros!")
    print("Escolha o caminho certo: A, B ou C.")
    print("A: Sequ√™ncia l√≥gica que organiza ideias e verifica erros.")
    print("B: Pule etapas, causando erros.")
    print("C: Repita a√ß√µes infinitamente, sem fim.")
    resposta = input("Qual caminho? (A, B ou C): ").strip().upper()
    global xp
    if resposta == "A":
        print("Parab√©ns! Voc√™ passou.")
        xp += 20
        passar_nivel()
        historico.append("Desafio 3: Passou")
        return True
    else:
        print("Caminho errado!")
        historico.append("Desafio 3: N√£o passou")
        return False

# ------------------- EXECU√á√ÉO PRINCIPAL -------------------

iniciar_jogo()

# Menu inicial
while True:
    menu_inicial()
    escolha = input("Escolha uma op√ß√£o: ").strip()
    if escolha == "1":
        cadastro()
        break
    elif escolha == "2":
        login()
        break
    else:
        print("Op√ß√£o inv√°lida. Tente novamente.")

# Menu de jogadores
menu()

# Loop das fases
while rodando and nivel <= 3:
    if nivel == 1:
        if nivel_1():
            nivel += 1
    elif nivel == 2:
        if nivel_2():
            nivel += 1
    elif nivel == 3:
        if nivel_3():
            nivel += 1
            rodando = False

print("Voc√™ passou da fase 1, parab√©ns!")
